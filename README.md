# تحديثات مشروع Ress: نظام خريطة السيرفر التفاعلية

## المقدمة

تم تحديث مشروع Ress لإضافة نظام "خريطة السيرفر التفاعلية"، والذي يتيح لأعضاء السيرفر استكشاف أقسامه المختلفة بطريقة جذابة ومنظمة. يتضمن هذا النظام أمر إعدادات شامل يسمح لمالكي السيرفر بتخصيص الخريطة بالكامل، بما في ذلك تفعيلها/تعطيلها، تغيير الصورة، تعديل رسالة الترحيب، وإدارة الأزرار التفاعلية التي توجه المستخدمين إلى معلومات محددة أو رومات داخل السيرفر. كما تم دمج ميزة إرسال الخريطة تلقائيًا للأعضاء الجدد عند انضمامهم للسيرفر.

## الأوامر الجديدة

تم إضافة أمرين جديدين للتحكم في نظام خريطة السيرفر:

### 1. `map-setup/` (أمر إعدادات الخريطة)

هذا الأمر مخصص لمالكي السيرفر فقط ويسمح بالتحكم الكامل في نظام خريطة السيرفر. عند استخدام الأمر، ستظهر لوحة تحكم تفاعلية تحتوي على الأزرار التالية:

*   **تفعيل/تعطيل**: لتشغيل أو إيقاف نظام خريطة السيرفر.
*   **تغيير الصورة**: لتحديد رابط صورة جديدة للخريطة. يمكن استخدام أي رابط صورة صالح.
*   **تعديل الرسالة**: لتغيير رسالة الترحيب التي تظهر مع الخريطة.
*   **إضافة زر**: لإضافة زر تفاعلي جديد إلى الخريطة. عند إضافة زر، سيُطلب منك إدخال:
    *   **اسم الزر**: النص الذي سيظهر على الزر.
    *   **شرح الزر**: المحتوى الذي سيظهر للمستخدم في رسالة مخفية عند الضغط على الزر.
    *   **رابط الروم (اختياري)**: رابط لروم معين في ديسكورد، والذي سيظهر كزر رابط داخل الرسالة المخفية.
*   **مسح الأزرار**: لحذف جميع الأزرار المضافة حاليًا.

**كيفية الاستخدام:**

```
/map-setup
```

### 2. `map/` (أمر عرض الخريطة)

يستخدم هذا الأمر لعرض خريطة السيرفر التفاعلية في أي قناة. سيقوم البوت بإرسال الصورة المحددة للخريطة مع رسالة الترحيب والأزرار التفاعلية التي تم إعدادها.

**كيفية الاستخدام:**

```
/map
```

## التغييرات في الكود

تم إجراء التغييرات التالية في بنية المشروع:

### 1. `data/serverMapConfig.json`

تم إنشاء ملف جديد لتخزين إعدادات خريطة السيرفر. يحتوي هذا الملف على:

*   `enabled`: قيمة منطقية (true/false) لتحديد ما إذا كان النظام مفعلًا أم لا.
*   `imageUrl`: رابط الصورة المستخدمة كخريطة.
*   `welcomeMessage`: رسالة الترحيب التي تظهر مع الخريطة.
*   `buttons`: مصفوفة تحتوي على تفاصيل كل زر (label, description, link).

### 2. `commands/map.js`

هذا الملف يحتوي على منطق أمر `/map`. يقوم بتحميل الإعدادات من `serverMapConfig.json`، ثم ينشئ صورة الخريطة باستخدام مكتبة `canvas` (بطريقة مشابهة لأمر البروفايل)، ويرسلها مع الأزرار التفاعلية. عند تفاعل المستخدم مع الأزرار، يتم إرسال رسالة مخفية تحتوي على الشرح الخاص بالزر، وإذا كان هناك رابط روم، يتم تضمين زر رابط للانتقال إليه.

### 3. `commands/map-setup.js`

يحتوي هذا الملف على منطق أمر `/map-setup`. يوفر واجهة تفاعلية (باستخدام Discord Buttons و Modals) لمالكي السيرفر لتعديل إعدادات الخريطة وحفظها في `serverMapConfig.json`.

### 4. `bot.js`

تم تعديل الملف الرئيسي للبوت (`bot.js`) لدمج الميزات الجديدة:

*   **معالج `guildMemberAdd`**: عند انضمام عضو جديد إلى السيرفر، يتحقق البوت مما إذا كان نظام الخريطة مفعلًا. إذا كان كذلك، فإنه يقوم تلقائيًا بإرسال رسالة الخريطة التفاعلية إلى قناة النظام (أو أول قناة نصية يجدها).
*   **معالج `interactionCreate`**: تم توسيع هذا المعالج للتعامل مع التفاعلات القادمة من أزرار الخريطة. عندما يضغط المستخدم على زر من أزرار الخريطة، يقوم البوت بالرد برسالة مخفية تحتوي على الشرح الخاص بالزر، بالإضافة إلى زر رابط إذا تم تحديده في الإعدادات.

## كيفية تفعيل واستخدام النظام

1.  **رفع التغييرات**: قم برفع الملفات الجديدة والمعدلة إلى مستودع GitHub الخاص بك.
2.  **إعادة تشغيل البوت**: بعد رفع التغييرات، أعد تشغيل البوت الخاص بك لتطبيق التحديثات.
3.  **إعداد الخريطة**: استخدم الأمر `/map-setup` في أي قناة نصية في سيرفرك. ستظهر لك لوحة تحكم تفاعلية:
    *   **تفعيل النظام**: اضغط على زر "تفعيل" لتشغيل نظام الخريطة.
    *   **تغيير الصورة**: اضغط على "تغيير الصورة" وأدخل رابط الصورة التي تريد استخدامها كخريطة.
    *   **تعديل رسالة الترحيب**: اضغط على "تعديل الرسالة" لتغيير النص الذي يظهر مع الخريطة.
    *   **إضافة الأزرار**: اضغط على "إضافة زر" لإنشاء أزرار جديدة. لكل زر، حدد اسمه، وشرحه، ورابط الروم المرتبط به (إذا وجد).
4.  **اختبار الخريطة**: بعد الإعداد، يمكنك استخدام الأمر `/map` لعرض الخريطة في أي قناة. كما سيتم إرسالها تلقائيًا لأي عضو جديد ينضم إلى السيرفر.

## الخلاصة

يوفر نظام خريطة السيرفر التفاعلية تجربة فريدة ومنظمة لأعضاء سيرفرك، مما يسهل عليهم التنقل واكتشاف المحتوى. بفضل لوحة التحكم الشاملة، يمكنك تخصيص الخريطة بالكامل لتناسب احتياجات سيرفرك.

## المراجع

[1] Discord.js Guide - Buttons: [https://discordjs.guide/legacy/interactive-components/buttons](https://discordjs.guide/legacy/interactive-components/buttons)
[2] Discord Developer Portal - Interactions: [https://discord.com/developers/docs/interactions/receiving-and-responding](https://discord.com/developers/docs/interactions/receiving-and-responding)
[3] Canvas NPM Package: [https://www.npmjs.com/package/canvas](https://www.npmjs.com/package/canvas)
